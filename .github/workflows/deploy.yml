    - name: Deploy application
      run: |
        source $HOME/.bashrc
        export PATH=$HOME/yandex-cloud/bin:$PATH
        
        # –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π deployment —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
        kubectl delete deployment examyandexapp -n examyandexapp --ignore-not-found=true
        
        # –ñ–¥–µ–º –æ—á–∏—Å—Ç–∫–∏
        sleep 10
        
        # –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ–≥–æ deployment
        kubectl apply -f - <<EOF
        apiVersion: apps/v1
        kind: Deployment
        metadata:
          name: examyandexapp
          namespace: examyandexapp
        spec:
          replicas: 2
          selector:
            matchLabels:
              app: examyandexapp
          template:
            metadata:
              labels:
                app: examyandexapp
            spec:
              containers:
              - name: examyandexapp
                image: cr.yandex/${{ env.REGISTRY_ID }}/examyandexapp:latest
                ports:
                - containerPort: 8080
                env:
                - name: DB_HOST
                  valueFrom:
                    secretKeyRef:
                      name: postgres-secret
                      key: db-host
                - name: DB_PORT
                  valueFrom:
                    secretKeyRef:
                      name: postgres-secret
                      key: db-port
                - name: DB_NAME
                  valueFrom:
                    secretKeyRef:
                      name: postgres-secret
                      key: db-name
                - name: DB_USER
                  valueFrom:
                    secretKeyRef:
                      name: postgres-secret
                      key: db-user
                - name: DB_PASSWORD
                  valueFrom:
                    secretKeyRef:
                      name: postgres-secret
                      key: db-password
                - name: ObjectStorage__AccessKey
                  valueFrom:
                    secretKeyRef:
                      name: objectstorage-secret
                      key: access-key
                - name: ObjectStorage__SecretKey
                  valueFrom:
                    secretKeyRef:
                      name: objectstorage-secret
                      key: secret-key
                - name: ObjectStorage__BucketName
                  valueFrom:
                    secretKeyRef:
                      name: objectstorage-secret
                      key: bucket-name
                - name: ObjectStorage__ServiceUrl
                  value: "https://storage.yandexcloud.net"
                resources:
                  requests:
                    memory: "256Mi"
                    cpu: "250m"
                  limits:
                    memory: "512Mi"
                    cpu: "500m"
                # –ò–°–ü–†–ê–í–õ–ï–ù–ù–´–ï HEALTH CHECKS
                livenessProbe:
                  httpGet:
                    path: /  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–Ω–µ–≤–æ–π –ø—É—Ç—å
                    port: 8080
                  initialDelaySeconds: 60  # –ë–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –∑–∞–ø—É—Å–∫
                  periodSeconds: 10
                  timeoutSeconds: 5
                readinessProbe:
                  httpGet:
                    path: /  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–æ—Ä–Ω–µ–≤–æ–π –ø—É—Ç—å
                    port: 8080
                  initialDelaySeconds: 30
                  periodSeconds: 5
                  timeoutSeconds: 3
        ---
        apiVersion: v1
        kind: Service
        metadata:
          name: examyandexapp-service
          namespace: examyandexapp
        spec:
          selector:
            app: examyandexapp
          ports:
          - port: 80
            targetPort: 8080
          type: LoadBalancer
        EOF
        
        echo "üöÄ New deployment applied, waiting for pods to start..."
        sleep 30
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å
        echo "=== Current Pod Status ==="
        kubectl get pods -n examyandexapp -o wide
        
        # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ª–æ–≥–∏ –Ω–æ–≤—ã—Ö –ø–æ–¥–æ–≤
        echo "=== New Pod Logs ==="
        for pod in $(kubectl get pods -n examyandexapp -o jsonpath='{.items[*].metadata.name}'); do
          echo "--- Logs for pod $pod ---"
          kubectl logs -n examyandexapp $pod --tail=10 || echo "No logs available for $pod"
        done
        
        # –û–∂–∏–¥–∞–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
        echo "=== Waiting for rollout to complete ==="
        kubectl rollout status deployment/examyandexapp -n examyandexapp --timeout=600s
        
        # –§–∏–Ω–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        echo "=== Final Status ==="
        kubectl get pods -n examyandexapp -o wide
        kubectl get service -n examyandexapp
        
        echo "üéâ Application deployed successfully!"